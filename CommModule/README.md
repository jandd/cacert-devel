# Signer client and server

The files in this directory implement the CAcert signer protocol version 1.

File | Purpose
--- | ---
client.pl |	The real client, running on the webserver
commdaemon | Script to run client.pl or server.pl
commmodule | Script for startup/shutdown of CommModule from /etc/init.d
logclean.sh	| Maintenance script for logfiles generated by CommModule
serial.conf | Serial Port configuration file
server.pl | The real server, running on the signing server

## Code formatting

To get a consistent formatting of the Perl code we use
[perltidy](https://metacpan.org/pod/distribution/Perl-Tidy/bin/perltidy) with the following options:

```
perltidy -i=2 -pt=2 -nsfs -wn -nolc -noll $filename.pl
```

## Runtime configuration

Both `client.pl` and `server.pl` can be configured using a set of environment variables.

### Configuration for `client.pl`

Variable | Purpose | Default value
--- | --- | ---
`SERIAL_PORT` | Serial port for communication with the signer | `/dev/ttyUSB0`
`CRT_DIR` | Directory where certificates are written | `../crt`
`CRL_DIR` | Directory where certificate revocation lists are written | `../www`
`SMTP_HOST` | Hostname of the SMTP server for sending confirmation mails | `localhost`
`SMTP_PORT` | Port of the SMTP server | `25`
`SMTP_HELO_NAME` | Hostname to send to the SMTP server during connection establishment | `hlin.cacert.org`
`SMTP_RETURN_ADDRESS` | Return email address | `returns@cacert.org`
`SMTP_X_MAILER` | Name to be used for the `X-Mailer` email header | `CAcert.org Website`
`SMTP_ERRORS_TO` | Address to use in the `Errors-To` email header | same as `SMTP_RETURN_ADDRESS`
`MYSQL_WEBDB_DATABASE` | database name for the WebDB MySQL database | None
`MYSQL_WEBDB_HOSTNAME` | database hostname | None
`MYSQL_WEBDB_USER` | database user | None
`MYSQL_WEBDB_PASSWORD` | database password | None

### Configuration for `server.pl`

Variable | Purpose | Default value
--- | --- | ---
`SIGNER_CPS_URL` || URL of the certificate practice statement | `http://www.cacert.org/cps.php`
`SIGNER_OCSP_URL` | URL of the OCSP responder | `http://ocsp.cacert.org/`
`SERIAL_PORT` | Serial port for communication with the signer client | `/dev/ttyUSB0`
`SIGNER_WORKDIR` | Working directory for signing operations | `./work`
`SIGNER_CA_CONFIG` | Location of CA configuration files | `/etc/ssl`
`SIGNER_BASEDIR` | Base directory for signer operation | `.`
`SIGNER_GPG_KEYRING_DIR` | Base directory for the gpg keyring files | `.`
`SIGNER_GPG_ID` | Identifier for the gpg key to use for signing | `gpg@cacert.org`
`SIGNER_GPG_CERT_DIGEST` | Digest algorithm to use for gpg key certificate signatures | `SHA256`
